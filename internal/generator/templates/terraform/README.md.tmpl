# Terraform Infrastructure

This directory contains Terraform configuration for provisioning AWS infrastructure for {{.ProjectName}}.

## Prerequisites

1. **Install Terraform**: https://www.terraform.io/downloads
2. **AWS Credentials**: Configure your AWS credentials

```bash
aws configure
```

Or use environment variables:

```bash
export AWS_ACCESS_KEY_ID="your-access-key"
export AWS_SECRET_ACCESS_KEY="your-secret-key"
export AWS_REGION="us-east-1"
```

## Usage

### Initialize Terraform

```bash
cd terraform
terraform init
```

### Plan Infrastructure Changes

```bash
terraform plan
```

### Apply Infrastructure

```bash
terraform apply
```

**Note:** DynamoDB tables are created in code via `CreateTableIfNotExists` to ensure consistency between tests and production. See `internal/posts/dynamodb_table.go` for the table definition.

### Destroy Infrastructure

```bash
terraform destroy
```

## Outputs

After applying, Terraform will output:
- AWS account information (for reference)

## Configuration

Edit `variables.tf` or create a `terraform.tfvars` file:

```hcl
aws_region  = "us-west-2"
environment = "production"
```

## State Management

For production, use remote state:

```hcl
terraform {
  backend "s3" {
    bucket = "your-terraform-state-bucket"
    key    = "{{.ProjectName}}/terraform.tfstate"
    region = "us-east-1"
  }
}
```

## IAM Permissions

When running on AWS infrastructure (EC2, ECS, Lambda, etc.), the application uses IAM roles for authentication. The IAM role needs these DynamoDB permissions:
- `dynamodb:CreateTable` (for table creation if it doesn't exist)
- `dynamodb:DescribeTable`
- `dynamodb:PutItem`
- `dynamodb:GetItem`
- `dynamodb:Query`
- `dynamodb:DeleteItem`


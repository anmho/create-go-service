# create-go-service

A CLI tool that scaffolds production-ready Go microservice boilerplate with a modern TUI interface.

**Note**: This repository serves dual purposes:
1. **CLI Tool**: The `create-go-service` CLI tool (aliased as `cgs`) for generating microservice boilerplate
2. **Example Template**: This repository itself serves as an example of the generated structure

## Features

- ğŸ¨ **Interactive TUI**: Modern terminal user interface built with Bubbletea
- ğŸš€ **Multiple API Frameworks**: Chi (REST), gRPC with ConnectRPC
- ğŸ’¾ **Database Support**: DynamoDB and PostgreSQL
- ğŸ“Š **Optional Features**: PostHog analytics, JWT authentication, Prometheus metrics
- ğŸ—„ï¸ **Migrations**: Atlas Go for PostgreSQL migrations
- ğŸ³ **Docker Support**: Complete Docker and docker-compose setup
- ğŸš¢ **Deployment**: Fly.io configuration with GitHub Actions CI/CD
- ğŸ”¥ **Hot Reload**: wgo for fast development iteration
- âœ… **Testing**: Comprehensive test templates with testcontainers

## Installation

### Homebrew (Recommended)

```bash
# Add the tap
brew tap anmho/tap

# Install create-go-service
brew install create-go-service

# Now you can run it from anywhere
create-go-service
# Or use the shorter alias
cgs
```

To uninstall:

```bash
brew uninstall create-go-service
```

### Manual Installation

```bash
# Install to /usr/local/bin (may require sudo)
make cli-install

# Now you can run it from anywhere
create-go-service
# Or use the shorter alias
cgs
```

To uninstall:

```bash
make cli-uninstall
```

### Running Without Installation

To test the CLI tool without installing:

```bash
# Run directly
go run cmd/create-go-service/main.go

# Or use make
make cli-run

# Or build and run
make cli-build
./bin/create-go-service
# Or use the alias
./bin/cgs
```

## Usage

The CLI will launch an interactive TUI (Text User Interface) where you can:

- Configure project name, module path, and output directory
- Select API framework (Chi or gRPC) - single choice
- Choose database (DynamoDB or PostgreSQL)
- Select optional features (PostHog, JWT Auth) - multi-select
- Configure deployment (Fly.io)

**Navigation:**
- `â†‘/â†“` or `j/k` - Navigate options
- `Space` - Toggle selection (multi-select)
- `Enter` - Confirm and continue
- `Esc` - Go back
- `Ctrl+C` or `q` - Quit

## Generated Service Configuration

Services generated by `create-go-service` use a **stage-based configuration approach**:

- **YAML Files**: Non-sensitive settings per stage (local, development, production) - committed to git
  - `local.yaml` - Local development settings
  - `development.yaml` - Development environment settings
  - `production.yaml` - Production settings (gitignored by default)
- **Environment Variables**: Secrets only (JWT keys, database credentials, API keys) - gitignored

**Setup:**
```bash
# In your generated service directory
cp .env.example .env
# Edit .env with your secrets
```

**Configuration Loading:**
1. Load stage-specific YAML file (based on `STAGE` environment variable)
2. Load secrets from environment variables (required)

See [Configuration Guide](docs/CONFIG.md) for detailed documentation.

## Generated Service Features

### API Frameworks

- **Chi (REST)**: Fast, lightweight HTTP router with middleware support
- **gRPC (ConnectRPC)**: Modern gRPC with HTTP/1.1 and HTTP/2 support, reflection enabled in local stage

### Database Support

- **DynamoDB**: 
  - Automatic table creation with `CreateTableIfNotExists`
  - Local development with DynamoDB Local
  - IAM role support for AWS environments
- **PostgreSQL**:
  - Atlas Go migrations
  - `pgx` driver with native struct scanning
  - Testcontainers for testing

### Optional Features

- **PostHog**: Event tracking and analytics (optional)
- **JWT Auth**: Token-based authentication (optional)
- **Metrics**: Prometheus metrics (always included)
- **Hot Reload**: wgo for development (always included)

### Testing

- Testcontainers for integration tests
- Parallel test execution (`t.Parallel()`)
- DynamoDB Local and PostgreSQL testcontainers
- Comprehensive test coverage

## Development

### Running Tests

```bash
# Run all tests
go test ./...

# Run generator tests specifically
go test -v ./internal/generator/...

# Run a specific test
go test -v ./internal/generator/... -run TestTemplateEmbedding
```

The test suite includes:
- **Template Embedding Tests**: Verify all templates are correctly embedded
- **Template Execution Tests**: Ensure templates execute without errors
- **Project Generation Tests**: End-to-end tests that generate complete projects
- **Template Data Tests**: Validate template data mapping
- **Parallel Execution**: All tests run in parallel for faster execution

### Project Structure

```
create-go-service/
â”œâ”€â”€ cmd/
â”‚   â””â”€â”€ create-go-service/        # CLI tool entry point
â”œâ”€â”€ internal/
â”‚   â”œâ”€â”€ cli/                       # CLI command handlers
â”‚   â”œâ”€â”€ tui/                       # Bubbletea TUI components
â”‚   â”œâ”€â”€ generator/                 # Code generation logic
â”‚   â”‚   â”œâ”€â”€ templates/             # Embedded template files
â”‚   â”‚   â”œâ”€â”€ project.go             # Project structure generator
â”‚   â”‚   â””â”€â”€ templates.go           # Template loading
â”‚   â””â”€â”€ [other packages]
â”œâ”€â”€ docs/                          # Documentation
â””â”€â”€ README.md                      # This file
```

## Architecture

The generator uses:

- **Embedded Templates**: All templates are embedded in the binary using `//go:embed`
- **Template System**: Go's `text/template` package for code generation
- **Stage-Based Config**: YAML files per stage with environment variable secrets
- **Provider Agnostic**: Database implementations are provider-agnostic

See [Design Document](docs/DESIGN.md) for detailed architecture information.

## Releasing

Releases are automated using [GoReleaser](https://goreleaser.com/). To create a new release:

1. **Create and push a tag:**
   ```bash
   git tag -a v1.0.0 -m "Release v1.0.0"
   git push origin v1.0.0
   ```

2. **Or use the Makefile:**
   ```bash
   make release TAG=v1.0.0
   ```

3. **GitHub Actions will automatically:**
   - Build binaries for all platforms (Linux, macOS, Windows)
   - Create a GitHub release with changelog
   - Update the Homebrew formula in `anmho/homebrew-tap`
   - Generate checksums

To test a release locally:

```bash
# Install GoReleaser
brew install goreleaser

# Test snapshot release
make snapshot
```

The Homebrew formula will be automatically updated in your `anmho/homebrew-tap` repository when you push a tag.

## Contributing

1. Fork the repository
2. Create a feature branch
3. Make your changes
4. Add tests for new functionality
5. Ensure all tests pass
6. Submit a pull request

## License

MIT License - see LICENSE file for details.
